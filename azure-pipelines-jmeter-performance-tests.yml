jobs:
- job: jmeter
  pool:
    vmImage: windows-2019
  displayName: Run JMeter tests
  steps:
  - task: Bash@3
    displayName: Execute JMeter tests
    inputs:
      targetType: filePath
      filePath: 'azure/jmeter/test.sh'
      arguments: '$PWD test/jmeter-performance-tests.jmx $(host)'
      workingDirectory: azure/jmeter
      failOnStderr: false
  - task: PublishPipelineArtifact@1
    displayName: Publish JMeter Report
    inputs:
      targetPath: azure/jmeter/report
      artifact: jmeter
  - task: AzureFileCopy@4
    inputs:
      SourcePath: 'azure/jmeter/report*'
      azureSubscription: 'azdo.pipelines.cip.S108D.arm10a1d6de-2cee-4f62-b5fa-2cf08d05a1dc'
      Destination: 'AzureBlob'
      storage: 's108d01devstr'
      ContainerName: '$web'
